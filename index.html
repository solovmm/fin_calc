<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Инфляционный калькулятор</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.55);
      --accent:#7c3aed;
      --good:#22c55e;
      --bad:#ef4444;
      --shadow:0 16px 50px rgba(0,0,0,.35);
      --radius:18px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(124,58,237,.25), transparent 55%),
        radial-gradient(1000px 600px at 85% 15%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(900px 700px at 40% 95%, rgba(239,68,68,.10), transparent 55%),
        linear-gradient(180deg, #070b16 0%, var(--bg) 100%);
      min-height:100vh;
      padding:22px 18px 40px;
    }
    .wrap{max-width:1020px;margin:0 auto}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:40px;height:40px;border-radius:14px;
      background:linear-gradient(135deg, rgba(124,58,237,.9), rgba(34,197,94,.6));
      box-shadow:0 10px 30px rgba(124,58,237,.25);
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.14);
    }
    .brand h1{font-size:16px;margin:0;letter-spacing:.2px;line-height:1.2}
    .brand .sub{font-size:12.5px;color:var(--muted2);margin-top:2px}
    .actions{display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap}
    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      transition:transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      font-size:13px;
    }
    .btn:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.20)}
    .btn:active{transform:scale(.99)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(124,58,237,.95), rgba(124,58,237,.65));
      border-color:rgba(124,58,237,.25);
      box-shadow:0 12px 34px rgba(124,58,237,.24);
    }
    .btn.primary:hover{background:linear-gradient(135deg, rgba(124,58,237,1), rgba(124,58,237,.75))}
    .btn.small{padding:10px 12px}
    .icon{width:18px;height:18px;opacity:.9;flex:0 0 auto}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{padding:16px 16px 12px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .title{font-size:15px;margin:0;letter-spacing:.2px}
    .hint{margin:4px 0 0;color:var(--muted2);font-size:12.5px;line-height:1.35}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      font-size:12px;color:var(--muted);
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      padding:7px 10px;border-radius:999px;white-space:nowrap;
    }
    .pill strong{color:rgba(255,255,255,.90);font-weight:600}
    .bd{padding:0 16px 16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media (max-width:560px){.row{grid-template-columns:1fr}}
    .rowYears{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;margin-top:10px;align-items:end}
    @media (max-width:560px){.rowYears{grid-template-columns:1fr}}
    .swapBig{width:44px;height:44px;border-radius:14px;justify-content:center}
    @media (max-width:560px){.swapBig{width:100%}}
    .labelRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:0 0 8px}
    label{display:block;font-size:12.5px;color:var(--muted);margin:0}
    .helpBtn{
      width:26px;height:26px;border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.86);
      cursor:pointer;
      display:grid;place-items:center;
      font-weight:700;font-size:13px;
      transition:background .15s ease,border-color .15s ease,transform .08s ease;
      user-select:none;
    }
    .helpBtn:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.22)}
    .helpBtn:active{transform:scale(.99)}
    .tooltip{
      display:none;
      margin-top:8px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.80);
      font-size:12.5px;
      line-height:1.4;
    }
    .tooltip b{color:rgba(255,255,255,.92)}
    .field{
      position:relative;
      background:rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:10px 12px;
      display:flex;gap:10px;align-items:center;
      min-height:44px;
    }
    .field:focus-within{
      border-color:rgba(124,58,237,.42);
      box-shadow:0 0 0 4px rgba(124,58,237,.14);
    }
    input[type="text"], select{
      width:100%;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:16px;
      font-family:var(--sans);
    }
    select{appearance:none}
    .prefix{
      width:28px;height:28px;border-radius:10px;
      display:grid;place-items:center;
      background:rgba(124,58,237,.14);
      border:1px solid rgba(124,58,237,.22);
      color:rgba(255,255,255,.92);
      font-weight:800;
      font-family:var(--mono);
      flex:0 0 auto;
    }
    .suffix{
      color:var(--muted2);
      font-size:12px;
      padding-left:6px;
      border-left:1px solid rgba(255,255,255,.10);
      white-space:nowrap;
    }
    .summary{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      cursor:pointer;
      user-select:none;
    }
    .summary:hover{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.05)}
    .summary .left{display:flex;gap:10px;align-items:center}
    .summary .badge{
      width:28px;height:28px;border-radius:10px;
      display:grid;place-items:center;
      background:rgba(124,58,237,.18);
      border:1px solid rgba(124,58,237,.25);
      flex:0 0 auto;
    }
    .summary .txt{font-size:12.5px;color:rgba(255,255,255,.82);line-height:1.35}
    .summary .txt b{color:rgba(255,255,255,.92)}
    .calcbar{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;align-items:center}
    .calcbar .btn{flex:1 1 180px;justify-content:center}
    .calcbar .btn.small{flex:0 0 auto}
    .kbd{
      font-family:var(--mono);
      font-size:12px;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.05);
      color:rgba(255,255,255,.88);
      white-space:nowrap;
    }
    .toast{
      display:none;
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(239,68,68,.10);
      border:1px solid rgba(239,68,68,.30);
      color:rgba(255,255,255,.90);
      font-size:13px;
      line-height:1.35;
    }
    .toast.ok{background:rgba(34,197,94,.10);border-color:rgba(34,197,94,.30)}
    .spinner{
      width:16px;height:16px;border-radius:50%;
      border:2px solid rgba(255,255,255,.25);
      border-top-color:rgba(255,255,255,.85);
      animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .result{padding:16px}
    .kpi{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;align-items:flex-start}
    @media (max-width:700px){.kpi{grid-template-columns:1fr}}
    .big{font-size:34px;letter-spacing:.2px;margin:0}
    .big .mono{font-family:var(--mono)}
    .note{margin:8px 0 0;color:var(--muted);font-size:13px;line-height:1.4}
    .statgrid{display:grid;grid-template-columns:1fr;gap:10px}
    .stat{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px 12px;
    }
    .stat .lbl{font-size:12px;color:var(--muted2)}
    .stat .val{font-size:16px;margin-top:3px}
    .val.good{color:rgba(34,197,94,.95)}
    .val.bad{color:rgba(239,68,68,.95)}
    .spark{
      margin-top:12px;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px 12px 12px;
    }
    .spark .lbl{
      font-size:12px;color:var(--muted2);margin-bottom:8px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .spark svg{width:100%;height:92px;display:block}
    .spark .axis{
      display:flex;justify-content:space-between;
      color:var(--muted2);font-size:11px;margin-top:6px;
    }
    .divider{height:1px;background:rgba(255,255,255,.10);margin:14px 0}
    .search{
      margin-top:10px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .search input{
      background:rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:10px 12px;
      color:var(--text);
      outline:none;
      width:100%;
      font-size:14px;
    }
    .warn{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(239,68,68,.30);
      background:rgba(239,68,68,.10);
      color:rgba(255,255,255,.88);
      font-size:13px;
      display:none;
      line-height:1.35;
    }

    /* Modal */
    .modalBack{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;
      padding:18px;z-index:50;
    }
    .modal{
      width:100%;max-width:720px;
      background:rgba(12,18,34,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      box-shadow:0 25px 90px rgba(0,0,0,.55);
      overflow:hidden;
      backdrop-filter:blur(10px);
    }
    .modal .mh{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modal .mh h3{margin:0;font-size:14px;letter-spacing:.2px}
    .modal .mc{
      padding:14px 16px 16px;
      color:rgba(255,255,255,.86);
      font-size:13px;
      line-height:1.5;
    }
    .modal .mc ul{margin:10px 0 0;padding-left:18px}
    .modal .mc li{margin:6px 0;color:rgba(255,255,255,.82)}
    .modal .mc .src{color:rgba(255,255,255,.70);margin-top:10px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M4 13.5V19a1 1 0 0 0 1 1h2.2a1 1 0 0 0 .95-.68l.75-2.26a2 2 0 0 1 1.9-1.36h2.4a2 2 0 0 1 1.9 1.36l.75 2.26a1 1 0 0 0 .95.68H19a1 1 0 0 0 1-1v-5.5" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M7 11.5c2.2-2.7 7.8-2.7 10 0" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M9.3 9c1.1-1.3 4.3-1.3 5.4 0" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Инфляционный калькулятор</h1>
          <div class="sub">1991–2024 (общий ИПЦ) и 1993–2024 (детальные категории)</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnHelp" title="Короткая справка">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M12 18h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M22 12A10 10 0 1 1 12 2a10 10 0 0 1 10 10Z" stroke="currentColor" stroke-width="2"/>
          </svg>
          Справка
        </button>
        <button class="btn" id="btnCopy" title="Скопировать результат">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M9 9h10v10H9z" stroke="currentColor" stroke-width="2" />
            <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="currentColor" stroke-width="2" />
          </svg>
          Копировать
        </button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="hd">
          <div>
            <h2 class="title">Введите цену и годы</h2>
            <p class="hint">Цена в одном году, пересчёт в цены другого года (по выбранной группе ИПЦ).</p>
          </div>
          <div class="pill" id="dataBadge">
            <strong>Данные:</strong> <span id="dataBadgeText">загрузка…</span>
          </div>
        </div>

        <div class="bd">
          <div class="warn" id="warnFile">
            Вы открыли файл напрямую (file://). В этом режиме браузер может блокировать загрузку JSON с данными.<br/>
            Откройте папку через локальный сервер: <span class="kbd">python3 -m http.server 8000</span>, затем перейдите на <span class="kbd">http://localhost:8000/</span>.
          </div>

          <!-- Amount -->
          <div style="margin-top:10px;">
            <div class="labelRow">
              <label for="amount">Сколько стоило</label>
              <button class="helpBtn" type="button" data-tip="tipAmount">?</button>
            </div>
            <div class="field">
              <div class="prefix">₽</div>
              <input id="amount" inputmode="numeric" autocomplete="off" placeholder="100 000" />
              <div class="suffix">руб.</div>
            </div>
            <div class="tooltip" id="tipAmount">
              Исходная цена. Пример: «телефон стоил 100 000 ₽».
            </div>
          </div>

          <!-- Category search + select -->
          <div class="search">
            <input id="catSearch" placeholder="Поиск по категории (например: мясо, транспорт, услуги)"/>
          </div>

          <div class="row" style="margin-top:10px;">
            <div style="grid-column:1 / -1;">
              <div class="labelRow">
                <label for="category">Категория (ряд ИПЦ)</label>
                <button class="helpBtn" type="button" data-tip="tipCat">?</button>
              </div>
              <div class="field">
                <select id="category"></select>
              </div>
              <div class="tooltip" id="tipCat">
                «Все товары и услуги» соответствует общему ИПЦ. Детальные категории доступны с 1993 года.
              </div>
            </div>
          </div>

          <!-- Years -->
          <div class="rowYears">
            <div>
              <div class="labelRow">
                <label for="fromYear">Год, в котором эта цена была</label>
                <button class="helpBtn" type="button" data-tip="tipFrom">?</button>
              </div>
              <div class="field">
                <select id="fromYear"></select>
              </div>
              <div class="tooltip" id="tipFrom">
                Год, в ценах которого указана исходная сумма.
              </div>
            </div>

            <button class="btn swapBig" id="btnSwap" type="button" title="Поменять годы местами">↔</button>

            <div>
              <div class="labelRow">
                <label for="toYear">Перевести в цены года</label>
                <button class="helpBtn" type="button" data-tip="tipTo">?</button>
              </div>
              <div class="field">
                <select id="toYear"></select>
              </div>
              <div class="tooltip" id="tipTo">
                Год, в цены которого вы хотите пересчитать.
              </div>
            </div>
          </div>

          <!-- Summary -->
          <div class="summary" id="summarySwap" title="Нажмите, чтобы поменять годы местами (↔)">
            <div class="left">
              <div class="badge" aria-hidden="true">⏳</div>
              <div class="txt">
                Сейчас вы считаете: <b id="flowText">—</b>.
                <span style="color:rgba(255,255,255,.65)">Нажмите здесь, чтобы посчитать наоборот.</span>
              </div>
            </div>
            <div class="kbd">↔</div>
          </div>

          <div class="calcbar">
            <button class="btn small" id="btnSetMax" type="button" title="Поставить последний доступный год как целевой">Сейчас</button>

            <button class="btn primary" id="btnCalc" type="button">
              <span id="calcIcon" style="display:inline-flex;align-items:center;gap:8px;">
                <svg class="icon" viewBox="0 0 24 24" fill="none">
                  <path d="M7 12h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M12 7v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
                </svg>
                Рассчитать
              </span>
              <span id="calcLoading" style="display:none;align-items:center;gap:8px;">
                <span class="spinner" aria-hidden="true"></span>
                Считаю…
              </span>
            </button>
          </div>

          <div id="rangeNote" class="hint" style="margin-top:10px;"></div>
          <div id="toast" class="toast"></div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="hd">
          <div>
            <h2 class="title">Результат</h2>
            <p class="hint" id="resultHint">Загрузите данные, выберите категорию, затем нажмите «Рассчитать».</p>
          </div>
          <div class="pill"><strong>Формат:</strong> <span class="kbd">₽</span> и <span class="kbd">%</span></div>
        </div>

        <div class="result">
          <div class="kpi">
            <div>
              <p class="big" id="resMain"><span class="mono">—</span></p>
              <p class="note" id="resLine">—</p>
            </div>

            <div class="statgrid">
              <div class="stat">
                <div class="lbl">Разница</div>
                <div class="val" id="resDiff">—</div>
              </div>
              <div class="stat">
                <div class="lbl">В процентах</div>
                <div class="val" id="resPct">—</div>
              </div>
              <div class="stat">
                <div class="lbl">Во сколько раз</div>
                <div class="val" id="resFactor">—</div>
              </div>
            </div>
          </div>

          <div class="spark" id="sparkBox" style="display:none;">
            <div class="lbl">
              <span>Эквивалент по годам</span>
              <span class="kbd" id="sparkSpan">—</span>
            </div>
            <svg id="sparkSvg" viewBox="0 0 300 92" preserveAspectRatio="none" aria-label="График"></svg>
            <div class="axis">
              <span id="sparkMin">—</span>
              <span id="sparkMax">—</span>
            </div>
          </div>

          <div class="divider"></div>

          <div class="hint" id="resultMeta">
            Подсказка: чтобы ответить на «сколько стоило тогда», нажмите <span class="kbd">↔</span> (годы поменяются местами).
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <h3>Справка</h3>
        <button class="btn" id="btnCloseHelp" type="button">Закрыть</button>
      </div>
      <div class="mc">
        <div><b>Что делает калькулятор</b></div>
        <ul>
          <li>Берет выбранный ряд ИПЦ (общий или по категории).</li>
          <li>Считает относительный уровень цен по годам и переводит сумму из года A в цены года B.</li>
          <li>Если категория имеет данные не за все годы, список годов автоматически ограничивается.</li>
        </ul>
        <div class="src" id="srcMeta">Источник: загрузка…</div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
